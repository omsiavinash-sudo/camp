{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect}from'react';import axios from'../utils/axios';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export function AuthProvider(_ref){let{children}=_ref;const[user,setUser]=useState(null);const login=async(username,password)=>{try{console.log('Making login request to:',axios.defaults.baseURL);// NOTE: include credentials so cookies (connect.sid) are sent/accepted\nconst response=await axios.post('/api/auth/login',{username,password},{withCredentials:true}// <-- important\n);console.log('Login response:',response.data);setUser(response.data.user);if(response.data.token){localStorage.setItem('token',response.data.token);}localStorage.setItem('user',JSON.stringify(response.data.user));}catch(error){// improved logging (error.response may be undefined when blocked by CORS)\nif(error.response){console.error('Login request failed:',error.response.status,error.response.data);}else{console.error('Login request failed:',error.message||error);}throw error;}};const logout=()=>{setUser(null);localStorage.removeItem('token');localStorage.removeItem('user');};// On mount, restore user from localStorage if available\nuseEffect(()=>{const storedUser=localStorage.getItem('user');if(storedUser){setUser(JSON.parse(storedUser));}},[]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,login,logout},children:children});}export function useAuth(){return useContext(AuthContext);}","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","axios","jsx","_jsx","AuthContext","AuthProvider","_ref","children","user","setUser","login","username","password","console","log","defaults","baseURL","response","post","withCredentials","data","token","localStorage","setItem","JSON","stringify","error","status","message","logout","removeItem","storedUser","getItem","parse","Provider","value","useAuth"],"sources":["/home/ubuntu/application/frontend/src/contexts/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\nimport axios from '../utils/axios';\n\nconst AuthContext = createContext();\n\nexport function AuthProvider({ children }) {\n  const [user, setUser] = useState(null);\n\n  const login = async (username, password) => {\n    try {\n      console.log('Making login request to:', axios.defaults.baseURL);\n      // NOTE: include credentials so cookies (connect.sid) are sent/accepted\n      const response = await axios.post(\n        '/api/auth/login',\n        { username, password },\n        { withCredentials: true } // <-- important\n      );\n      console.log('Login response:', response.data);\n      setUser(response.data.user);\n      if (response.data.token) {\n        localStorage.setItem('token', response.data.token);\n      }\n      localStorage.setItem('user', JSON.stringify(response.data.user));\n    } catch (error) {\n      // improved logging (error.response may be undefined when blocked by CORS)\n      if (error.response) {\n        console.error('Login request failed:', error.response.status, error.response.data);\n      } else {\n        console.error('Login request failed:', error.message || error);\n      }\n      throw error;\n    }\n  };\n\n  const logout = () => {\n    setUser(null);\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n  };\n\n  // On mount, restore user from localStorage if available\n  useEffect(() => {\n    const storedUser = localStorage.getItem('user');\n    if (storedUser) {\n      setUser(JSON.parse(storedUser));\n    }\n  }, []);\n\n  return (\n    <AuthContext.Provider value={{ user, login, logout }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  return useContext(AuthContext);\n}\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,aAAa,CAAEC,UAAU,CAAEC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAC7E,MAAO,CAAAC,KAAK,KAAM,gBAAgB,CAAC,OAAAC,GAAA,IAAAC,IAAA,yBAEnC,KAAM,CAAAC,WAAW,cAAGP,aAAa,CAAC,CAAC,CAEnC,MAAO,SAAS,CAAAQ,YAAYA,CAAAC,IAAA,CAAe,IAAd,CAAEC,QAAS,CAAC,CAAAD,IAAA,CACvC,KAAM,CAACE,IAAI,CAAEC,OAAO,CAAC,CAAGV,QAAQ,CAAC,IAAI,CAAC,CAEtC,KAAM,CAAAW,KAAK,CAAG,KAAAA,CAAOC,QAAQ,CAAEC,QAAQ,GAAK,CAC1C,GAAI,CACFC,OAAO,CAACC,GAAG,CAAC,0BAA0B,CAAEb,KAAK,CAACc,QAAQ,CAACC,OAAO,CAAC,CAC/D;AACA,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAAhB,KAAK,CAACiB,IAAI,CAC/B,iBAAiB,CACjB,CAAEP,QAAQ,CAAEC,QAAS,CAAC,CACtB,CAAEO,eAAe,CAAE,IAAK,CAAE;AAC5B,CAAC,CACDN,OAAO,CAACC,GAAG,CAAC,iBAAiB,CAAEG,QAAQ,CAACG,IAAI,CAAC,CAC7CX,OAAO,CAACQ,QAAQ,CAACG,IAAI,CAACZ,IAAI,CAAC,CAC3B,GAAIS,QAAQ,CAACG,IAAI,CAACC,KAAK,CAAE,CACvBC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAEN,QAAQ,CAACG,IAAI,CAACC,KAAK,CAAC,CACpD,CACAC,YAAY,CAACC,OAAO,CAAC,MAAM,CAAEC,IAAI,CAACC,SAAS,CAACR,QAAQ,CAACG,IAAI,CAACZ,IAAI,CAAC,CAAC,CAClE,CAAE,MAAOkB,KAAK,CAAE,CACd;AACA,GAAIA,KAAK,CAACT,QAAQ,CAAE,CAClBJ,OAAO,CAACa,KAAK,CAAC,uBAAuB,CAAEA,KAAK,CAACT,QAAQ,CAACU,MAAM,CAAED,KAAK,CAACT,QAAQ,CAACG,IAAI,CAAC,CACpF,CAAC,IAAM,CACLP,OAAO,CAACa,KAAK,CAAC,uBAAuB,CAAEA,KAAK,CAACE,OAAO,EAAIF,KAAK,CAAC,CAChE,CACA,KAAM,CAAAA,KAAK,CACb,CACF,CAAC,CAED,KAAM,CAAAG,MAAM,CAAGA,CAAA,GAAM,CACnBpB,OAAO,CAAC,IAAI,CAAC,CACba,YAAY,CAACQ,UAAU,CAAC,OAAO,CAAC,CAChCR,YAAY,CAACQ,UAAU,CAAC,MAAM,CAAC,CACjC,CAAC,CAED;AACA9B,SAAS,CAAC,IAAM,CACd,KAAM,CAAA+B,UAAU,CAAGT,YAAY,CAACU,OAAO,CAAC,MAAM,CAAC,CAC/C,GAAID,UAAU,CAAE,CACdtB,OAAO,CAACe,IAAI,CAACS,KAAK,CAACF,UAAU,CAAC,CAAC,CACjC,CACF,CAAC,CAAE,EAAE,CAAC,CAEN,mBACE5B,IAAA,CAACC,WAAW,CAAC8B,QAAQ,EAACC,KAAK,CAAE,CAAE3B,IAAI,CAAEE,KAAK,CAAEmB,MAAO,CAAE,CAAAtB,QAAA,CAClDA,QAAQ,CACW,CAAC,CAE3B,CAEA,MAAO,SAAS,CAAA6B,OAAOA,CAAA,CAAG,CACxB,MAAO,CAAAtC,UAAU,CAACM,WAAW,CAAC,CAChC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}