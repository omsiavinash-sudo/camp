{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Box,Paper,Typography,Button,List,ListItem,ListItemText,ListItemSecondaryAction,CircularProgress}from'@mui/material';import{useParams,useNavigate}from'react-router-dom';import axios from'../utils/axios';import{useAuth}from'../contexts/AuthContext';import{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";export default function CampRegistrations(){const{camp_id}=useParams();const navigate=useNavigate();const{user}=useAuth();const[registrations,setRegistrations]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState('');useEffect(()=>{if(!camp_id)return;setLoading(true);setError('');axios.get(\"/api/registrations/camp/\".concat(camp_id)).then(res=>setRegistrations(res.data||[])).catch(()=>setError('Failed to load registrations')).finally(()=>setLoading(false));},[camp_id]);const handleExport=()=>{if(!registrations||!registrations.length)return;const headers=['Registration ID','OPD Number','First Name','Middle Name','Last Name','Age','Mobile','Aadhar','Email','Guardian Type','Guardian Name','Last Period','Marital Status','Marriage Date','No of Children','Abortions','Highest Education','Employment','Address','Remarks','Screening & Awareness','Previously Screened','Reason for Consultation','Camp ID'];const rows=registrations.map(r=>[r.registration_id,r.opd_number,r.first_name,r.middle_name,r.last_name,r.age,r.mobile,r.aadhar,r.email,r.guardian_type||r.guardian_type_name||'',r.guardian_name,r.last_period_date,r.marital_status||r.marital_status_name||'',r.marriage_date,r.children_count,r.abortion_count,r.highest_education,r.employment,r.address,r.remarks,r.vaccination_awareness?'Yes':'No',r.previously_screened?'Yes':'No',Array.isArray(r.consultation_reasons)?r.consultation_reasons.join('; '):r.consultation_reasons||'',r.camp_id]);const csvContent=[headers,...rows].map(e=>e.map(v=>'\"'+String(v!==null&&v!==void 0?v:'')+'\"').join(',')).join('\\n');const blob=new Blob([csvContent],{type:'text/csv;charset=utf-8;'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=\"camp_\".concat(camp_id,\"_registrations.csv\");a.click();URL.revokeObjectURL(url);};return/*#__PURE__*/_jsx(Box,{sx:{p:2},children:/*#__PURE__*/_jsxs(Paper,{sx:{p:2},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',alignItems:'center',mb:2},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",children:[\"Registrations for Camp #\",camp_id]}),/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",sx:{mr:1},onClick:()=>navigate(\"/camps/\".concat(camp_id,\"/register\")),children:\"New Registration\"}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",color:\"success\",onClick:handleExport,children:\"Export to CSV\"})]})]}),loading&&/*#__PURE__*/_jsx(Box,{sx:{textAlign:'center',py:3},children:/*#__PURE__*/_jsx(CircularProgress,{})}),error&&/*#__PURE__*/_jsx(Typography,{color:\"error\",children:error}),!loading&&!error&&(!registrations||registrations.length===0)&&/*#__PURE__*/_jsx(Typography,{children:\"No registrations found for this camp.\"}),!loading&&registrations&&registrations.length>0&&/*#__PURE__*/_jsx(List,{children:registrations.map(reg=>/*#__PURE__*/_jsxs(ListItem,{divider:true,children:[/*#__PURE__*/_jsx(ListItemText,{primary:\"\".concat(reg.opd_number,\" \\u2014 \").concat(reg.first_name),secondary:\"Guardian: \".concat(reg.guardian_name||'-',\" | Age: \").concat(reg.age||'-',\" | Mobile: \").concat(reg.mobile||'-',\" | Aadhar: \").concat(reg.aadhar||'-')}),/*#__PURE__*/_jsx(ListItemSecondaryAction,{children:/*#__PURE__*/_jsx(Button,{size:\"small\",onClick:()=>navigate(\"/registration/\".concat(reg.registration_id)),children:\"View Details\"})})]},reg.registration_id))})]})});}","map":{"version":3,"names":["React","useEffect","useState","Box","Paper","Typography","Button","List","ListItem","ListItemText","ListItemSecondaryAction","CircularProgress","useParams","useNavigate","axios","useAuth","jsxs","_jsxs","jsx","_jsx","CampRegistrations","camp_id","navigate","user","registrations","setRegistrations","loading","setLoading","error","setError","get","concat","then","res","data","catch","finally","handleExport","length","headers","rows","map","r","registration_id","opd_number","first_name","middle_name","last_name","age","mobile","aadhar","email","guardian_type","guardian_type_name","guardian_name","last_period_date","marital_status","marital_status_name","marriage_date","children_count","abortion_count","highest_education","employment","address","remarks","vaccination_awareness","previously_screened","Array","isArray","consultation_reasons","join","csvContent","e","v","String","blob","Blob","type","url","URL","createObjectURL","a","document","createElement","href","download","click","revokeObjectURL","sx","p","children","display","justifyContent","alignItems","mb","variant","color","mr","onClick","textAlign","py","reg","divider","primary","secondary","size"],"sources":["/home/ubuntu/application/frontend/src/pages/CampRegistrations.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Box, Paper, Typography, Button, List, ListItem, ListItemText, ListItemSecondaryAction, CircularProgress } from '@mui/material';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport axios from '../utils/axios';\nimport { useAuth } from '../contexts/AuthContext';\n\nexport default function CampRegistrations() {\n  const { camp_id } = useParams();\n  const navigate = useNavigate();\n  const { user } = useAuth();\n  const [registrations, setRegistrations] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n\n  useEffect(() => {\n    if (!camp_id) return;\n    setLoading(true);\n    setError('');\n    axios.get(`/api/registrations/camp/${camp_id}`)\n      .then(res => setRegistrations(res.data || []))\n      .catch(() => setError('Failed to load registrations'))\n      .finally(() => setLoading(false));\n  }, [camp_id]);\n\n  const handleExport = () => {\n    if (!registrations || !registrations.length) return;\n    const headers = [\n      'Registration ID', 'OPD Number', 'First Name', 'Middle Name', 'Last Name', 'Age', 'Mobile', 'Aadhar', 'Email',\n      'Guardian Type', 'Guardian Name', 'Last Period', 'Marital Status', 'Marriage Date', 'No of Children', 'Abortions',\n      'Highest Education', 'Employment', 'Address', 'Remarks', 'Screening & Awareness', 'Previously Screened', 'Reason for Consultation', 'Camp ID'\n    ];\n    const rows = registrations.map(r => [\n      r.registration_id,\n      r.opd_number,\n  r.first_name,\n  r.middle_name,\n  r.last_name,\n      r.age,\n      r.mobile,\n      r.aadhar,\n      r.email,\n      r.guardian_type || r.guardian_type_name || '',\n      r.guardian_name,\n      r.last_period_date,\n      r.marital_status || r.marital_status_name || '',\n      r.marriage_date,\n      r.children_count,\n      r.abortion_count,\n      r.highest_education,\n      r.employment,\n      r.address,\n      r.remarks,\n      r.vaccination_awareness ? 'Yes' : 'No',\n      r.previously_screened ? 'Yes' : 'No',\n      Array.isArray(r.consultation_reasons) ? r.consultation_reasons.join('; ') : (r.consultation_reasons || ''),\n      r.camp_id\n    ]);\n    const csvContent = [headers, ...rows].map(e => e.map(v => '\"' + String(v ?? '') + '\"').join(',')).join('\\n');\n    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `camp_${camp_id}_registrations.csv`;\n    a.click();\n    URL.revokeObjectURL(url);\n  };\n\n  return (\n    <Box sx={{ p: 2 }}>\n      <Paper sx={{ p: 2 }}>\n        <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>\n          <Typography variant=\"h6\">Registrations for Camp #{camp_id}</Typography>\n          <Box>\n            <Button variant=\"contained\" color=\"primary\" sx={{ mr: 1 }} onClick={() => navigate(`/camps/${camp_id}/register`)}>New Registration</Button>\n            <Button variant=\"outlined\" color=\"success\" onClick={handleExport}>Export to CSV</Button>\n          </Box>\n        </Box>\n\n        {loading && <Box sx={{ textAlign: 'center', py: 3 }}><CircularProgress /></Box>}\n        {error && <Typography color=\"error\">{error}</Typography>}\n\n        {!loading && !error && (!registrations || registrations.length === 0) && (\n          <Typography>No registrations found for this camp.</Typography>\n        )}\n\n        {!loading && registrations && registrations.length > 0 && (\n          <List>\n            {registrations.map(reg => (\n              <ListItem key={reg.registration_id} divider>\n                <ListItemText\n                  primary={`${reg.opd_number} â€” ${reg.first_name}`}\n                  secondary={`Guardian: ${reg.guardian_name || '-'} | Age: ${reg.age || '-'} | Mobile: ${reg.mobile || '-'} | Aadhar: ${reg.aadhar || '-'}`}\n                />\n                <ListItemSecondaryAction>\n                  <Button size=\"small\" onClick={() => navigate(`/registration/${reg.registration_id}`)}>View Details</Button>\n                </ListItemSecondaryAction>\n              </ListItem>\n            ))}\n          </List>\n        )}\n      </Paper>\n    </Box>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}